<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6-Image Merge Upload</title>
</head>
<body>
  <h2>Upload 6 Screenshots for Giveaway</h2>

  <input type="file" id="images" accept="image/*" multiple>
  <button onclick="mergeAndUpload()">Merge & Upload</button>

  <p id="status"></p>
  <img id="preview" style="max-width:500px; display:none; margin-top:10px;">

  <script>
    const API_KEY = "61efcea661db85bc3909f88fd02010d3"; // replace with your key
    const MAX_IMAGES = 6;
    const CANVAS_WIDTH = 1200; // final merged image width
    const CANVAS_HEIGHT = 1200; // final merged image height

    async function mergeAndUpload() {
      const files = document.getElementById("images").files;
      const status = document.getElementById("status");
      const preview = document.getElementById("preview");

      if (files.length !== MAX_IMAGES) {
        status.innerText = `Please select exactly ${MAX_IMAGES} images.`;
        return;
      }

      status.innerText = "Merging images...";

      // Create canvas
      const canvas = document.createElement("canvas");
      canvas.width = CANVAS_WIDTH;
      canvas.height = CANVAS_HEIGHT;
      const ctx = canvas.getContext("2d");

      // Grid layout: 3 columns x 2 rows for 6 images
      const cols = 3;
      const rows = 2;
      const cellWidth = CANVAS_WIDTH / cols;
      const cellHeight = CANVAS_HEIGHT / rows;

      // Load images
      const imagePromises = Array.from(files).map(file => {
        return new Promise(resolve => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.src = URL.createObjectURL(file);
        });
      });

      const images = await Promise.all(imagePromises);

      // Draw images on canvas
      images.forEach((img, i) => {
        const x = (i % cols) * cellWidth;
        const y = Math.floor(i / cols) * cellHeight;
        ctx.drawImage(img, x, y, cellWidth, cellHeight);
      });

      // Convert canvas to blob & upload
      canvas.toBlob(async blob => {
        status.innerText = "Uploading merged image...";

        const formData = new FormData();
        formData.append("image", blob);

        try {
          const res = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
            method: "POST",
            body: formData
          });

          const data = await res.json();

          if (data.success) {
            const url = data.data.url;
            preview.src = url;
            preview.style.display = "block";
            status.innerText = "Merged image uploaded successfully!";
            console.log("Merged image URL:", url);
          } else {
            status.innerText = "Upload failed!";
            console.error(data);
          }
        } catch (err) {
          status.innerText = "Error uploading!";
          console.error(err);
        }

      }, "image/png");
    }
  </script>
</body>
</html>
